<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>감정 이미지 생성 툴</title>
<style>
  body {
    font-family: "Pretendard", sans-serif;
    background: #f7f7fb;
    padding: 30px;
  }
  h2 {
    font-weight: 700;
    margin-bottom: 25px;
  }
  .top-bar {
    display: flex;
    gap: 20px;
    margin-bottom: 25px;
    flex-wrap: wrap;
    align-items: center;
  }
  .switch-box {
    display: flex;
    gap: 10px;
    background: #fff;
    padding: 10px 15px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  input[type="text"] {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  input[type="file"] {
    padding: 5px;
  }
  button {
    padding: 10px 18px;
    border: none;
    background: #4c6ef5;
    color: white;
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.15s;
  }
  button:hover {
    background: #3b5bdb;
  }
  .upload-area {
    display: flex;
    flex-direction: column;
    gap: 20px;
    max-width: 600px;
  }
  .item {
    display: flex;
    align-items: center;
    gap: 20px;
  }
  .dropzone {
    width: 120px;
    height: 120px;
    border: 2px dashed #aaa;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    user-select: none;
    background-size: cover;
    background-position: center;
    color: #666;
    font-size: 14px;
    background-color: #fff;
    transition: 0.2s;
  }
  .dropzone:hover {
    border-color: #4c6ef5;
    color: #4c6ef5;
  }
  #customAdd {
    width: 120px;
    height: 120px;
    border: 2px solid #4c6ef5;
    border-radius: 12px;
    background: #edf2ff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 40px;
    cursor: pointer;
    transition: 0.2s;
  }
  #customAdd:hover {
    background: #dbe4ff;
  }
</style>
</head>
<body>
  <h2>감정 이미지 생성 툴</h2>

  <div class="top-bar">
    <div class="switch-box">
      <label><input type="radio" name="mode" value="user" checked> 유저</label>
      <label><input type="radio" name="mode" value="char"> 캐릭터</label>
    </div>

    <div>
      이름: <input type="text" id="nameInput" placeholder="이름 입력" />
    </div>

    <div>
      감정 txt 불러오기: <input type="file" id="txtLoader" accept=".txt" />
    </div>

    <button id="makeZip">zip 다운로드</button>
    <button id="autoDownload">자동 다운로드</button>
  </div>

  <div id="list" class="upload-area"></div>

  <div id="customAdd">+</div>

<script>
  let defaultEmotions = [
    "smille", "angry", "sad", "surprised", "scared",
    "disgusted", "confused", "embarrassed", "blush", "bored", "laughing"
  ];

  let emotions = [...defaultEmotions];

  const list = document.getElementById("list");
  const nameInput = document.getElementById("nameInput");

  function render() {
    list.innerHTML = "";
    emotions.forEach((emo, idx) => {
      const item = document.createElement("div");
      item.className = "item";

      const dz = document.createElement("div");
      dz.className = "dropzone";
      dz.dataset.index = idx;
      dz.textContent = "empty";

      dz.addEventListener("dragover", e => e.preventDefault());
      dz.addEventListener("drop", onDrop);
      dz.addEventListener("click", () => selectFile(idx));

      const label = document.createElement("div");
      label.className = "label";
      label.textContent = getFileName(emo);

      item.appendChild(dz);
      item.appendChild(label);
      list.appendChild(item);
    });
  }

  function getFileName(emo) {
    const mode = document.querySelector('input[name="mode"]:checked').value;
    const name = nameInput.value.trim() || "____";
    if (mode === "user") return `user-${name}-${emo}.png`;
    return `${name}-${emo}.png`;
  }

  function onDrop(e) {
    e.preventDefault();
    const file = e.dataTransfer.files[0];
    if (!file) return;
    setImage(this, file);
  }

  function selectFile(idx) {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "image/*";
    input.onchange = () => {
      if (input.files[0]) setImage(document.querySelector(`.dropzone[data-index='${idx}']`), input.files[0]);
    };
    input.click();
  }

  function setImage(el, file) {
    const reader = new FileReader();
    reader.onload = e => {
      el.style.backgroundImage = `url(${e.target.result})`;
      el.textContent = "";
    };
    reader.readAsDataURL(file);
  }

  document.getElementById("txtLoader").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e2 => {
      emotions = e2.target.result.split(/\r?\n/).filter(x => x.trim());
      render();
    };
    reader.readAsText(file);
  });

  document.getElementById("customAdd").addEventListener("click", () => {
    const emo = prompt("추가할 감정 이름?");
    if (emo) {
      emotions.push(emo.trim());
      render();
    }
  });

  nameInput.addEventListener("input", render);
  document.querySelectorAll('input[name="mode"]').forEach(r => r.addEventListener("change", render));

  render();
</script>
</body>
</html>
